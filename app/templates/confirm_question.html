<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Confirm and Edit Question</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/confirm_question.css') }}">
  <!-- Optional: Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="confirm-question-container">
    <h1>Question Details</h1>
    
    <form id="confirmForm">
      <div class="form-group">
        <div class="form-group">
          <label for="certifcode">Certification Code:</label>
          <input type="text" id="certifcode" name="certifcode" value="{{ question_data.certifcode }}" required>
        </div>
        <label for="questionId">ID:</label>
        <input type="text" id="questionId" name="id" value="{{ question_data.id }}" required>
      </div>
      <div class="form-group">
        <label for="questionType">Question Type:</label>
        <input type="text" id="questionType" name="questiontype" value="{{ question_data.questiontype }}" required>
      </div>
      <div class="form-group">
        <label for="questionText">Question:</label>
        <textarea id="questionText" name="question" required>{{ question_data.question }}</textarea>
      </div>
      <div class="form-group">
        <label for="choices">Choices:</label>
        <input type="text" id="choices" name="choices" value="{{ question_data.choices }}" required>
      </div>
      
      <div class="form-group">
        <label for="answer">Answer:</label>
        <input type="text" id="answer" name="answer" value="{{ question_data.answer }}" required>
      </div>
      <div class="form-group">
        <label for="explanation">Explanation:</label>
        <textarea id="explanation" name="explanation" required>{{ question_data.explanation }}</textarea>
      </div>
  
   
      <button type="button" id="createQuestionBtn" class="btn-submit">Create Question</button>
    </form>
  </div>

  <script>
    // When the "Create Question" button is clicked, gather form data and POST to the insert endpoint.
    document.getElementById('createQuestionBtn').addEventListener('click', async () => {
      const form = document.getElementById('confirmForm');
      const formData = new FormData(form);
      
      // Convert FormData to JSON
      const data = {};
      formData.forEach((value, key) => { data[key] = value; });

      try {
        const response = await fetch('/submit_question', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const resultText = await response.text();  // Read as text first

        try {
          const result = JSON.parse(resultText);  // Attempt to parse JSON
          if (response.ok) {
            alert(result.message || "Question created successfully!");
            window.location.href = '/';  // Redirect on success
          } else {
            alert("Error: " + (result.error || "Failed to create question."));
          }
        } catch (jsonError) {
          console.error("Response was not valid JSON:", resultText);
          alert("Unexpected error. Server returned non-JSON response.");
        }
      } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
      }
    });

  </script>
</body>
</html>
